<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- External and internal stylesheets and favicon -->
    <link rel="stylesheet" href="/assets/css/dashboard-styles.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="icon" href="assets/img/ygsyp-favicon.png">
    <title>Dashboard</title>
    <style>
        
    </style>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h1 class="text-center mb-0">YGSYP Dashboard</h1>
            <button class="btn btn-danger" id="signOutBtn">Sign Out</button>
        </div>

        <!-- Blog Posts CRUD -->
        <div class="card">
            <div class="card-header">
                Blog Posts
            </div>
            <div class="card-body">
                <button class="btn btn-primary mb-2" onclick="openBlogModal('create')">Create Blog Post</button>
                <div id="blogPostsList"></div>
            </div>
        </div>

        <!-- Certificates CRUD -->
        <div class="card">
            <div class="card-header">
                Certificates
            </div>
            <div class="card-body">
                <button class="btn btn-primary mb-2" onclick="openCertificateModal('create')">Add Certificate</button>
                <div id="certificatesList"></div>
            </div>
        </div>

        <!-- Skills CRUD -->
        <div class="card">
            <div class="card-header">
                Skills
            </div>
            <div class="card-body">
                <button class="btn btn-primary mb-2" onclick="openSkillsModal('create')">Add Skill</button>
                <div id="skillsList"></div>
            </div>
        </div>

        <!-- Projects CRUD -->
        <div class="card">
            <div class="card-header">
                Projects
            </div>
            <div class="card-body">
                <button class="btn btn-primary mb-2" onclick="openProjectModal('create')">Add Project</button>
                <div id="projectsList"></div>
            </div>
        </div>
    </div>

    <!-- Modals for CRUD operations -->
    <!-- Blog Post Modal -->
    <div class="modal fade" id="blogModal" tabindex="-1" aria-labelledby="blogModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="blogModalLabel">Blog Post</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="blogForm">
                        <input type="hidden" id="blogPostId">
                        <div class="mb-3">
                            <label for="blogTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="blogTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="blogDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="blogDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="blogImageUrl" class="form-label">Image URL</label>
                            <input type="text" class="form-control" id="blogImageUrl" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Certificate Modal -->
    <div class="modal fade" id="certificateModal" tabindex="-1" aria-labelledby="certificateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="certificateModalLabel">Certificate</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="certificateForm">
                        <input type="hidden" id="certificateId">
                        <div class="mb-3">
                            <label for="certificateTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="certificateTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="certificateDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="certificateDescription" rows="3" required></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="certificateImageUrl" class="form-label">Image URL</label>
                            <input type="text" class="form-control" id="certificateImageUrl" required>
                        </div>
                        <div class="mb-3">
                            <label for="certificateLink" class="form-label">Certificate Link</label>
                            <input type="text" class="form-control" id="certificateLink" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Skills Modal -->
    <div class="modal fade" id="skillsModal" tabindex="-1" aria-labelledby="skillsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="skillsModalLabel">Skills</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="skillsForm">
                        <input type="hidden" id="skillName">
                        <div class="mb-3">
                            <label for="skillName" class="form-label">Skill Name</label>
                            <input type="text" class="form-control" id="skillName" required>
                        </div>
                        <div class="mb-3">
                            <label for="skillLevel" class="form-label">Skill Level (0-100)</label>
                            <input type="number" class="form-control" id="skillLevel" min="0" max="100" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Project Modal -->
    <div class="modal fade" id="projectModal" tabindex="-1" aria-labelledby="projectModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="projectModalLabel">Project</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="projectForm">
                        <input type="hidden" id="projectId">
                        <div class="mb-3">
                            <label for="projectTitle" class="form-label">Title</label>
                            <input type="text" class="form-control" id="projectTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="projectDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="projectDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="projectImageUrl" class="form-label">Image URL</label>
                            <input type="text" class="form-control" id="projectImageUrl">
                        </div>
                        <div class="mb-3">
                            <label for="projectSource" class="form-label">Source Link</label>
                            <input type="text" class="form-control" id="projectSource">
                        </div>
                        <button type="submit" class="btn btn-primary">Save</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="progress">
        <span id="progress-value">&#x1F815;</span>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getDatabase, ref, onValue, push, set, update, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCVvniHls7At9Izbz9LffU5FRB47Au29yU",
            authDomain: "ygsyportfolio.firebaseapp.com",
            projectId: "ygsyportfolio",
            storageBucket: "ygsyportfolio.appspot.com",
            messagingSenderId: "713286800029",
            appId: "1:713286800029:web:3985a3232743186005fa74",
            measurementId: "G-2TCF7MF9VB"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth();

        // Listen for authentication state changes
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('User is signed in:', user);
                // Call your display functions here
                displayBlogPosts();
                displayCertificates();
                displaySkills();
                displayProjects();
            } else {
                console.log('User is signed out');
                window.location.href = 'auth.html';  // Redirect to login page if signed out
            }
        });

        // Sign out function
        document.getElementById('signOutBtn').addEventListener('click', () => {
            signOut(auth).then(() => {
                console.log('User signed out');
            }).catch((error) => {
                console.error('Error signing out:', error);
            });
        });

        // Function to display blog posts
        window.displayBlogPosts = function displayBlogPosts() {
            const blogPostsRef = ref(database, 'blog-posts');
            onValue(blogPostsRef, (snapshot) => {
                const blogPostsList = document.getElementById('blogPostsList');
                blogPostsList.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    const post = childSnapshot.val();
                    const postId = childSnapshot.key;
                    const postElement = document.createElement('div');
                    postElement.classList.add('card', 'mb-2');
                    postElement.innerHTML = `
                        <div class="card-body">
                            <h5 class="card-title">${post.title}</h5>
                            <p class="card-text">${post.description}</p>
                            <img src="${post.imageUrl}" class="img-fluid mb-2" alt="${post.title}">
                            <button class="btn btn-sm btn-primary me-2" onclick="openBlogModal('edit', '${postId}', '${post.title.replace(/'/g, "\\'")}', '${post.description.replace(/'/g, "\\'")}', '${post.imageUrl}')">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteBlogPost('${postId}')">Delete</button>
                        </div>
                    `;
                    blogPostsList.appendChild(postElement);
                });
            });
        };

        // Function to add or edit a blog post
        window.handleBlogForm = function handleBlogForm(event, mode) {
            event.preventDefault();
            const form = document.getElementById('blogForm');
            const postId = form.blogPostId.value;
            const title = form.blogTitle.value;
            const description = form.blogDescription.value;
            const imageUrl = form.blogImageUrl.value;

            if (mode === 'create') {
                const newPostRef = push(ref(database, 'blog-posts'));
                set(newPostRef, {
                    title,
                    description,
                    imageUrl
                }).then(() => {
                    $('#blogModal').modal('hide');
                    form.reset();
                }).catch((error) => {
                    console.error('Error adding blog post: ', error);
                });
            } else if (mode === 'edit') {
                const postRef = ref(database, 'blog-posts/' + postId);
                set(postRef, {
                    title,
                    description,
                    imageUrl
                }).then(() => {
                    $('#blogModal').modal('hide');
                    form.reset();
                }).catch((error) => {
                    console.error('Error editing blog post: ', error);
                });
            }
        };
        // Function to delete a blog post
        window.deleteBlogPost = function deleteBlogPost(postId) {
            if (confirm("Are you sure you want to delete this blog post?")) {
                const postRef = ref(database, 'blog-posts/' + postId);
                remove(postRef).then(() => {
                    console.log("Blog post deleted successfully!");
                }).catch((error) => {
                    console.error("Error removing blog post: ", error);
                });
            }
        };

        // Function to open blog modal for create or edit
        window.openBlogModal = function openBlogModal(mode, postId, title, description, imageUrl) {
            const modalTitle = document.getElementById('blogModalLabel');
            const form = document.getElementById('blogForm');
            form.blogPostId.value = postId || '';
            if (mode === 'create') {
                modalTitle.textContent = 'Create Blog Post';
                form.blogTitle.value = '';
                form.blogDescription.value = '';
                form.blogImageUrl.value = '';
                form.onsubmit = (event) => handleBlogForm(event, 'create');
            } else if (mode === 'edit') {
                modalTitle.textContent = 'Edit Blog Post';
                form.blogTitle.value = title;
                form.blogDescription.value = description;
                form.blogImageUrl.value = imageUrl;
                form.onsubmit = (event) => handleBlogForm(event, 'edit');
            }
            $('#blogModal').modal('show');
        };

        // Function to display certificates
        window.displayCertificates = function displayCertificates() {
            const certificatesRef = ref(database, 'certificates');
            onValue(certificatesRef, (snapshot) => {
                const certificatesList = document.getElementById('certificatesList');
                certificatesList.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    const certificate = childSnapshot.val();
                    const certificateId = childSnapshot.key;
                    const certificateElement = document.createElement('div');
                    certificateElement.classList.add('card', 'mb-2');
                    certificateElement.innerHTML = `
                        <div class="card-body">
                            <h5 class="card-title">${certificate.title}</h5>
                            <p class="card-text">${certificate.description}</p>
                            <img src="${certificate.imageUrl}" class="img-fluid mb-2" alt="${certificate.title}">
                            <a href="${certificate.certificateLink}" target="_blank" class="btn btn-sm btn-primary me-2">View Certificate</a>
                            <button class="btn btn-sm btn-primary me-2" onclick="openCertificateModal('edit', '${certificateId}', '${certificate.title.replace(/'/g, "\\'")}', '${certificate.description.replace(/'/g, "\\'")}', '${certificate.imageUrl}', '${certificate.certificateLink}')">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteCertificate('${certificateId}')">Delete</button>
                        </div>
                    `;
                    certificatesList.appendChild(certificateElement);
                });
            });
        };

        // Function to add or edit a certificate
        window.handleCertificateForm = function handleCertificateForm(event, mode) {
            event.preventDefault();
            const form = document.getElementById('certificateForm');
            const certificateId = form.certificateId.value;
            const title = form.certificateTitle.value;
            const description = form.certificateDescription.value;
            const imageUrl = form.certificateImageUrl.value;
            const certificateLink = form.certificateLink.value;

            if (mode === 'create') {
                const newCertificateRef = push(ref(database, 'certificates'));
                set(newCertificateRef, {
                    title,
                    description,
                    imageUrl,
                    certificateLink
                }).then(() => {
                    $('#certificateModal').modal('hide');
                    form.reset();
                }).catch((error) => {
                    console.error('Error adding certificate: ', error);
                });
            } else if (mode === 'edit') {
                const certificateRef = ref(database, 'certificates/' + certificateId);
                set(certificateRef, {
                    title,
                    description,
                    imageUrl,
                    certificateLink
                }).then(() => {
                    $('#certificateModal').modal('hide');
                    form.reset();
                }).catch((error) => {
                    console.error('Error editing certificate: ', error);
                });
            }
        };

        // Function to delete a certificate
        window.deleteCertificate = function deleteCertificate(certificateId) {
            if (confirm("Are you sure you want to delete this certificate?")) {
                const certificateRef = ref(database, 'certificates/' + certificateId);
                remove(certificateRef).then(() => {
                    console.log("Certificate deleted successfully!");
                }).catch((error) => {
                    console.error("Error removing certificate: ", error);
                });
            }
        };

        // Function to open certificate modal for create or edit
        window.openCertificateModal = function openCertificateModal(mode, certificateId, title, description, imageUrl, certificateLink) {
            const modalTitle = document.getElementById('certificateModalLabel');
            const form = document.getElementById('certificateForm');
            form.certificateId.value = certificateId || '';
            if (mode === 'create') {
                modalTitle.textContent = 'Add Certificate';
                form.certificateTitle.value = '';
                form.certificateDescription.value = '';
                form.certificateImageUrl.value = '';
                form.certificateLink.value = '';
                form.onsubmit = (event) => handleCertificateForm(event, 'create');
            } else if (mode === 'edit') {
                modalTitle.textContent = 'Edit Certificate';
                form.certificateTitle.value = title;
                form.certificateDescription.value = description;
                form.certificateImageUrl.value = imageUrl;
                form.certificateLink.value = certificateLink;
                form.onsubmit = (event) => handleCertificateForm(event, 'edit');
            }
            $('#certificateModal').modal('show');
        };

        // Function to display skills
        window.displaySkills = function displaySkills() {
            const skillsRef = ref(database, 'skills');
            onValue(skillsRef, (snapshot) => {
                const skillsList = document.getElementById('skillsList');
                skillsList.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    const skill = childSnapshot.val();
                    const skillName = childSnapshot.key;
                    const skillElement = document.createElement('div');
                    skillElement.classList.add('card', 'mb-2');
                    skillElement.innerHTML = `
                        <div class="card-body">
                            <h5 class="card-title">${skillName.toUpperCase()}</h5>
                            <div class="progress mb-3">
                              <div class="progress-bar" role="progressbar" style="width: ${skill}%;" aria-valuenow="${skill}" aria-valuemin="0" aria-valuemax="100">${skill}%</div>
                            </div>
                            <button class="btn btn-sm btn-primary me-2" onclick="openSkillsModal('edit', '${skillName}', ${skill})">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteSkill('${skillName}')">Delete</button>
                        </div>
                    `;
                    skillsList.appendChild(skillElement);
                });
            });
        };


        // Function to add or edit a skill
        window.handleSkillForm = function handleSkillForm(event, mode) {
    event.preventDefault();
    const form = document.getElementById('skillsForm');
    const skillName = form.skillName.value.trim();  // Trim spaces
    const skillLevel = parseInt(form.skillLevel.value, 10);  // Parse integer

    if (skillName && !isNaN(skillLevel)) {
        const skillRef = ref(database, 'skills/' + skillName);
        set(skillRef, skillLevel).then(() => {
            $('#skillsModal').modal('hide');
            form.reset();
        }).catch((error) => {
            console.error('Error adding/editing skill: ', error);
        });
    } else {
        console.error('Invalid skill name or level');
    }
};


        // Function to delete a skill
        window.deleteSkill = function deleteSkill(skillName) {
            if (confirm("Are you sure you want to delete this skill?")) {
                const skillRef = ref(database, 'skills/' + skillName);
                remove(skillRef).then(() => {
                    console.log("Skill deleted successfully!");
                }).catch((error) => {
                    console.error("Error removing skill: ", error);
                });
            }
        };

        // Function to open skills modal for create or edit
        window.openSkillsModal = function openSkillsModal(mode, skillName, skillLevel) {
            const modalTitle = document.getElementById('skillsModalLabel');
            const form = document.getElementById('skillsForm');

            form.skillName.value = skillName || '';
            form.skillLevel.value = skillLevel || 0;

            if (mode === 'create') {
                modalTitle.textContent = 'Add Skill';
                form.onsubmit = (event) => handleSkillForm(event, 'create');
            } else if (mode === 'edit') {
                modalTitle.textContent = 'Edit Skill';
                form.onsubmit = (event) => handleSkillForm(event, 'edit');
            }
            $('#skillsModal').modal('show');
        };

        // Function to display projects
        window.displayProjects = function displayProjects() {
            const projectsRef = ref(database, 'projects');
            onValue(projectsRef, (snapshot) => {
                const projectsList = document.getElementById('projectsList');
                projectsList.innerHTML = '';
                snapshot.forEach((childSnapshot) => {
                    const project = childSnapshot.val();
                    const projectId = childSnapshot.key;
                    const projectElement = document.createElement('div');
                    projectElement.classList.add('card', 'mb-2');

                    // Function to escape both single and double quotes
                    const escapeString = (str) => {
                      return str.replace(/['"\\]/g, '\\$&');
            };

                    projectElement.innerHTML = `
                        <div class="card-body">
                            <h5 class="card-title">${project.title}</h5>
                            <p class="card-text">${project.description}</p>
                            <img src="${project.imgUrl}" class="img-fluid mb-2" alt="${project.title}">
                            <a href="${project.source}" target="_blank" class="btn btn-sm btn-primary me-2">View Source</a>
                            <button class="btn btn-sm btn-primary me-2" onclick="openProjectModal('edit', '${projectId}', '${project.title.replace(/'/g, "\\'")}', '${project.description.replace(/'/g, "\\'")}', '${project.imgUrl}', '${project.source}')">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProject('${projectId}')">Delete</button>
                        </div>
                    `;
                    projectsList.appendChild(projectElement);
                });
            });
        };

        // Function to add or edit a project
        window.handleProjectForm = function handleProjectForm(event, mode) {
            event.preventDefault();
            const form = document.getElementById('projectForm');
            const projectId = form.projectId.value;
            const title = form.projectTitle.value;
            const description = form.projectDescription.value;
            const imgUrl = form.projectImageUrl.value;
            const source = form.projectSource.value;

            if (mode === 'create') {
                const newProjectRef = push(ref(database, 'projects'));
                set(newProjectRef, {
                    title,
                    description,
                    imgUrl,
                    source
                }).then(() => {
                    $('#projectModal').modal('hide');
                    form.reset();
                }).catch((error) => {
                    console.error('Error adding project: ', error);
                });
            } else if (mode === 'edit') {
                const projectRef = ref(database, 'projects/' + projectId);
                set(projectRef, {
                    title,
                    description,
                    imgUrl,
                    source
                }).then(() => {
                    $('#projectModal').modal('hide');
                    form.reset();
                }).catch((error) => {
                    console.error('Error editing project: ', error);
                });
            }
        };

        // Function to delete a project
        window.deleteProject = function deleteProject(projectId) {
            if (confirm("Are you sure you want to delete this project?")) {
                const projectRef = ref(database, 'projects/' + projectId);
                remove(projectRef).then(() => {
                    console.log("Project deleted successfully!");
                }).catch((error) => {
                    console.error("Error removing project: ", error);
                });
            }
        };

        // Function to open project modal for create or edit
        window.openProjectModal = function openProjectModal(mode, projectId, title, description, imageUrl, source) {
            const modalTitle = document.getElementById('projectModalLabel');
            const form = document.getElementById('projectForm');
            form.projectId.value = projectId || '';
            if (mode === 'create') {
                modalTitle.textContent = 'Add Project';
                form.projectTitle.value = '';
                form.projectDescription.value = '';
                form.projectImageUrl.value = '';
                form.projectSource.value = '';
                form.onsubmit = (event) => handleProjectForm(event, 'create');
            } else if (mode === 'edit') {
                modalTitle.textContent = 'Edit Project';
                form.projectTitle.value = title;
                form.projectDescription.value = description;
                form.projectImageUrl.value = imageUrl;
                form.projectSource.value = source;
                form.onsubmit = (event) => handleProjectForm(event, 'edit');
            }
            $('#projectModal').modal('show');
        };
    </script>

     <!-- Bootstrap JS and dependencies -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.min.js" integrity="sha384-cuYeSxntonz0PPNlHhBs68uyIAVpIIOZZ5JqeqvYYIcEL727kskC66kF92t6Xl2V" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/typed.js/2.0.12/typed.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>

    <!-- Custom JavaScript -->
    <script src="/assets/js/dashboard-script.js" type="module"></script>
</body>
</html>
